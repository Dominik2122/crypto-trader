"use strict";(self.webpackChunkcrypto_trader=self.webpackChunkcrypto_trader||[]).push([[63],{9063:(st,g,r)=>{r.r(g),r.d(g,{TradingModule:()=>it});var l=r(8583),d=r(4402),t=r(7716),m=r(1250),h=r(3301),f=r(3611);let R=(()=>{class a{constructor(e,n){this.activatedRoute=e,this.router=n,this.placeholder="bitcoin",this.formConfig=[{type:m.y.SELECT,label:"Select crypto to trade",name:"crypto",showTicks:!0,placeholder:this.placeholder,options:[]}]}ngOnInit(){this.activatedRoute.data.pipe((0,h.j)("crypto")).subscribe(e=>{this.placeholder=e.cryptoData.name,this.options=e.otherCryptos,this.createForm()})}observeForm(e){e.valueChanges.subscribe(n=>{this.router.navigate(["trading"],{queryParams:{crypto:n.crypto}})})}createForm(){this.formConfig=[{type:m.y.SELECT,label:"Select date range",name:"crypto",showTicks:!0,placeholder:this.placeholder,options:this.options}]}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(d.gz),t.Y36(d.F0))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-trading-crypto-picker"]],decls:1,vars:1,consts:[[3,"config","formOutput"]],template:function(e,n){1&e&&(t.TgZ(0,"app-form",0),t.NdJ("formOutput",function(i){return n.observeForm(i)}),t.qZA()),2&e&&t.Q6J("config",n.formConfig)},directives:[f.U],styles:["app-trading-crypto-picker form.shadow-lg{box-shadow:unset}\n"],encapsulation:2,changeDetection:0}),a})();var b=r(4294),S=r(1438),B=r(6889),P=r(5146),$=r(7801),T=r(5207),J=r(5094),O=r(1598),I=r(9842);class U{constructor(o,e,n,s,i,u){this.balance=o,this.cryptoBalance=e,this.ownedCrypto=n,this.cryptoData=s,this.pastCryptoData=i,this.otherCryptos=u}}var Q=r(2739),y=r(5037),v=r(4478),C=r(8488);let p=(()=>{class a extends $.K{constructor(e,n,s,i){super(),this.transactionResource=e,this.headerAccountResource=n,this.ownedCryptoResource=s,this.homeTreeNodeResource=i,this.sold$=new J.X(null)}fetchTradingInfo(e){return(0,O.a)([this.headerAccountResource.getAccount(),this.ownedCryptoResource.fetchOwnedCrypto(),this.homeTreeNodeResource.getTreeNodes()]).pipe((0,T.U)(([n,s,i])=>{const u=i.find(c=>c.data.name===e),F=s.cryptos.find(c=>c.name===e);return new U(n.currentBalance,parseFloat(s.balance),F||new I.P(e,null,null,0),u.data,u.childData,i.map(c=>c.data.name).filter(c=>c!==e))}))}prepareNewTransaction(e,n){this.set(new P.I(e,n))}finalizeTransaction(){this.transactionResource.tradeCrypto(this.get()).pipe((0,b.q)(1)).subscribe(()=>{this.sold$.next()})}observeSold(){return this.sold$.asObservable()}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(Q.U),t.LFG(y.R),t.LFG(v.A),t.LFG(C._))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac}),a})();var M=r(1877),A=r(8131);function N(a,o){if(1&a&&(t.ynx(0),t.TgZ(1,"div",12),t.TgZ(2,"app-text-badge",13),t._uU(3),t.ALo(4,"price"),t.qZA(),t.qZA(),t.BQk()),2&a){const e=t.oxw();t.xp6(2),t.Q6J("color",e.priceAdded>0?"green":"red")("subtle",!0),t.xp6(1),t.AsE(" ",e.priceAdded>0?"+":null,"",t.lcZ(4,4,e.priceAdded),"$ ")}}function j(a,o){if(1&a&&(t.TgZ(0,"app-text-badge",14),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.Q6J("color",e.transaction.amount>0?"green":"red")("subtle",!0),t.xp6(1),t.AsE(" ",e.transaction.amount>0?"+":null,"",e.transaction.amount," ")}}function L(a,o){if(1&a&&(t.TgZ(0,"h2"),t._uU(1),t.ALo(2,"price"),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij("",t.lcZ(2,1,e.ownedCrypto.price*e.ownedCrypto.amount),"$")}}function Y(a,o){if(1&a&&(t.TgZ(0,"app-text-badge",13),t._uU(1),t.ALo(2,"price"),t.qZA()),2&a){const e=t.oxw();t.Q6J("color",e.transaction.amount>0?"green":"red")("subtle",!0),t.xp6(1),t.AsE(" ",e.priceAdded<0?"+":null,"",t.lcZ(2,4,-e.priceAdded),"$ ")}}let V=(()=>{class a{constructor(e,n){this.tradingService=e,this.changeDetectorRef=n}ngOnInit(){this.tradingService.observe().subscribe(e=>{this.transaction=e,this.createPriceAdded(),this.changeDetectorRef.detectChanges()})}createPriceAdded(){this.priceAdded=this.transaction?-this.transaction.amount*this.ownedCrypto.price:null,this.changeDetectorRef.detectChanges()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(p),t.Y36(t.sBO))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-trading-balance"]],inputs:{balance:"balance",ownedCrypto:"ownedCrypto"},decls:23,vars:12,consts:[[1,"flex","mt-4","md:block","md:mt-0","md:text-center"],[1,"w-full","items-center","flex","ml-5","md:justify-center","md:items-center","md:ml-0"],["color","green"],[4,"ngIf"],[1,"flex","md:block","mt-2","text-center"],[1,"md:flex","md:flex-col","md:items-center","ml-5","md:justify-center","md:ml-0","md:w-full"],[1,"flex","items-center","md:flex-col","justify-center"],["color","yellow",1,"md:mb-1","mr-2","md:mr-0"],["class","md:mb-1",3,"color","subtle",4,"ngIf"],[1,"mt-2","flex","md:flex-col","justify-center","items-center"],["color","yellow",1,"block","md:mb-1","mr-2","md:mr-0",3,"subtle"],[3,"color","subtle",4,"ngIf"],[1,"ml-2","flex","justify-center"],[3,"color","subtle"],[1,"md:mb-1",3,"color","subtle"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"h3"),t._uU(2,"Balance:"),t.qZA(),t.TgZ(3,"div",1),t.TgZ(4,"app-text-badge",2),t.TgZ(5,"h2"),t._uU(6),t.ALo(7,"price"),t.qZA(),t.qZA(),t.YNc(8,N,5,6,"ng-container",3),t.qZA(),t.qZA(),t.TgZ(9,"div",4),t.TgZ(10,"h4"),t._uU(11),t.ALo(12,"titlecase"),t.qZA(),t.TgZ(13,"div",5),t.TgZ(14,"div",6),t.TgZ(15,"app-text-badge",7),t.TgZ(16,"h2"),t._uU(17),t.qZA(),t.qZA(),t.YNc(18,j,2,4,"app-text-badge",8),t.qZA(),t.TgZ(19,"div",9),t.TgZ(20,"app-text-badge",10),t.YNc(21,L,3,3,"h2",3),t.qZA(),t.YNc(22,Y,3,6,"app-text-badge",11),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.hij("",t.lcZ(7,8,n.balance),"$"),t.xp6(2),t.Q6J("ngIf",n.priceAdded),t.xp6(3),t.hij("",t.lcZ(12,10,n.ownedCrypto.name)," balance: "),t.xp6(6),t.hij("",n.ownedCrypto.amount," units"),t.xp6(1),t.Q6J("ngIf",n.transaction&&n.transaction.amount),t.xp6(2),t.Q6J("subtle",!0),t.xp6(1),t.Q6J("ngIf",n.ownedCrypto.amount||n.transaction&&n.transaction.amount),t.xp6(1),t.Q6J("ngIf",n.transaction&&n.transaction.amount))},directives:[M.N,l.O5],pipes:[A.d,l.rS],styles:[""],encapsulation:2,changeDetection:0}),a})();var k=r(2687),Z=r(9504);let z=(()=>{class a{constructor(){this.disable=!1,this.amount$=new t.vpe,this.amount=0}ngOnInit(){this.createFormConfig()}ngOnChanges(e){e.disable&&this.createFormConfig(),e.clear$&&this.clear$.asObservable().subscribe(()=>{this.clearForm()})}observeForm(e){this.form=e,this.form.valueChanges.pipe((0,T.U)(n=>n.amount),(0,k.x)()).subscribe(n=>{n<0?this.setValue(0):n>this.maxAmount?this.setValue(this.maxAmount):(this.amount=n,this.amount$.next(n))})}increaseValue(){this.amount=this.amount?++this.amount:1,this.setValue(this.amount)}decreaseValue(){this.amount=--this.amount,this.setValue(this.amount)}isMinusDisabled(){return this.amount<=0||!this.amount}isPlusDisabled(){return this.amount>=this.maxAmount}createFormConfig(){this.config=[{type:m.y.NUMBER,label:this.label,name:"amount",placeholder:"Insert",disabled:this.disable}]}setValue(e){this.form&&this.form.controls.amount.setValue(e)}clearForm(){this.setValue(void 0)}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-trading-form"]],inputs:{label:"label",maxAmount:"maxAmount",disable:"disable",clear$:"clear$"},outputs:{amount$:"amount$"},features:[t.TTD],decls:6,vars:5,consts:[[1,"trading-form","flex","md:rounded-lg","md:shadow-lg","items-center","px-1","md:px-5"],[3,"disabled","click"],[3,"config","formOutput"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"app-button",1),t.NdJ("click",function(){return n.increaseValue()}),t._uU(2," + "),t.qZA(),t.TgZ(3,"app-form",2),t.NdJ("formOutput",function(i){return n.observeForm(i)}),t.qZA(),t.TgZ(4,"app-button",1),t.NdJ("click",function(){return n.decreaseValue()}),t._uU(5," - "),t.qZA(),t.qZA()),2&e&&(t.ekj("trading-window-disabled",n.disable),t.xp6(1),t.Q6J("disabled",n.isPlusDisabled()||n.disable),t.xp6(2),t.Q6J("config",n.config),t.xp6(1),t.Q6J("disabled",n.isMinusDisabled()||n.disable))},directives:[Z.r,f.U],styles:[".trading-form form{padding-left:1rem;padding-right:1rem}.trading-form label{display:block;text-align:center}.trading-form input{margin-left:auto;margin-right:auto;display:block;text-align:center;width:4rem}.trading-form input::-webkit-outer-spin-button,.trading-form input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.trading-form.trading-window-disabled{cursor:not-allowed;--tw-bg-opacity: 1;background-color:rgba(243,244,246,var(--tw-bg-opacity))}.trading-form.trading-window-disabled input{pointer-events:auto;cursor:not-allowed}.trading-form.trading-window-disabled label{cursor:not-allowed}.trading-form.trading-window-disabled form{cursor:not-allowed}\n"],encapsulation:2,changeDetection:0}),a})();var X=r(1731),x=r(4671),w=r(297),E=r(6499);let G=(()=>{class a{ngOnInit(){}ngOnChanges(e){e.data&&this.createChart(),e.currentPrice&&this.createChart()}createChart(){this.chartConfig=(new X.P).withXAxis(new w.n("timeseries",{display:!1,text:null},{parser:w._.DaysAndMonth})).withType("line"),this.chartData=(new x.l).withLabels(this.data.map(e=>e.date)).withDatasets([new x.b("Current price: "+this.currentPrice+"$",this.data.map(e=>e.price),"green","black",2)])}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-trading-chart"]],inputs:{data:"data",id:"id",currentPrice:"currentPrice"},features:[t.TTD],decls:1,vars:3,consts:[[3,"id","chartConfig","chartData"]],template:function(e,n){1&e&&t._UZ(0,"app-chart",0),2&e&&t.Q6J("id",n.id)("chartConfig",n.chartConfig)("chartData",n.chartData)},directives:[E.x],styles:[""],encapsulation:2,changeDetection:0}),a})();function q(a,o){if(1&a&&(t._UZ(0,"app-trading-chart",8),t.ALo(1,"price")),2&a){const e=t.oxw();t.Q6J("data",e.data.pastCryptoData)("id",e.data.cryptoData.name)("currentPrice",t.lcZ(1,3,e.data.cryptoData.currentPrice))}}let H=(()=>{class a{constructor(e,n,s,i){this.activatedRoute=e,this.router=n,this.tradingService=s,this.changeDetectorRef=i,this.sellAvailable=!0,this.buyAvailable=!0,this.tradeAvailable=!1,this.clearForm$=new B.x}ngOnInit(){this.activatedRoute.data.pipe((0,h.j)("crypto")).subscribe(e=>{this.data=e,this.clearForm$.next(),this.changeDetectorRef.detectChanges()}),this.observeSold()}getBuyMaxAmount(){return Math.floor(100*this.data.balance/this.data.cryptoData.currentPrice)/100}onSellAmount(e){e?(this.buyAvailable=!1,this.tradeAvailable=!0):this.resetDisabled(),this.tradingService.prepareNewTransaction(this.data.cryptoData.name,-e),this.changeDetectorRef.detectChanges()}onBuyAmount(e){e?(this.sellAvailable=!1,this.tradeAvailable=!0):this.resetDisabled(),this.tradingService.prepareNewTransaction(this.data.cryptoData.name,e),this.changeDetectorRef.detectChanges()}trade(){this.tradingService.finalizeTransaction()}fetchTradingInfo(){this.tradingService.fetchTradingInfo(this.data.cryptoData.name).pipe((0,b.q)(1)).subscribe(e=>{this.data=e,this.changeDetectorRef.detectChanges()})}observeSold(){this.tradingService.observeSold().pipe((0,S.T)(1)).subscribe(()=>{this.resetDisabled(),this.clearForm$.next(),this.tradingService.set(null),this.fetchTradingInfo(),this.changeDetectorRef.detectChanges()})}resetDisabled(){this.sellAvailable=!0,this.buyAvailable=!0,this.tradeAvailable=!1}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(d.gz),t.Y36(d.F0),t.Y36(p),t.Y36(t.sBO))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-trading-dashboard"]],decls:9,vars:10,consts:[[1,"block","w-full","items-center","md:flex"],["class","w-full",3,"data","id","currentPrice",4,"ngIf"],[1,"trading-balance",3,"balance","ownedCrypto"],[1,"flex","flex-col","md:flex-row","justify-between","items-center"],[1,"flex","w-full","justify-center","items-center"],["label","Sell",1,"md:mr-4",3,"maxAmount","disable","clear$","amount$"],["label","Buy",1,"md:ml-4",3,"maxAmount","disable","clear$","amount$"],[1,"text-4xl","mt-4","md:mt-0","mr-8",3,"disabled","click"],[1,"w-full",3,"data","id","currentPrice"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,q,2,5,"app-trading-chart",1),t._UZ(2,"app-trading-balance",2),t.qZA(),t.TgZ(3,"div",3),t.TgZ(4,"div",4),t.TgZ(5,"app-trading-form",5),t.NdJ("amount$",function(i){return n.onSellAmount(i)}),t.qZA(),t.TgZ(6,"app-trading-form",6),t.NdJ("amount$",function(i){return n.onBuyAmount(i)}),t.qZA(),t.qZA(),t.TgZ(7,"app-button",7),t.NdJ("click",function(){return n.trade()}),t._uU(8," Trade! "),t.qZA(),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",n.data),t.xp6(1),t.Q6J("balance",n.data.balance)("ownedCrypto",n.data.ownedCrypto),t.xp6(3),t.Q6J("maxAmount",n.data.ownedCrypto.amount)("disable",!n.sellAvailable)("clear$",n.clearForm$),t.xp6(1),t.Q6J("maxAmount",n.getBuyMaxAmount())("disable",!n.buyAvailable)("clear$",n.clearForm$),t.xp6(1),t.Q6J("disabled",!n.tradeAvailable))},directives:[l.O5,V,z,Z.r,G],pipes:[A.d],styles:[".trading-balance{width:230px}\n"],encapsulation:2,changeDetection:0}),a})(),K=(()=>{class a{constructor(){}ngOnInit(){}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-trading-root"]],decls:4,vars:0,consts:[[1,"trading-root-container"],[1,"border-gray-300","border-b-2"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t._UZ(2,"app-trading-crypto-picker"),t.qZA(),t._UZ(3,"app-trading-dashboard"),t.qZA())},directives:[R,H],styles:["app-trading-root .trading-root-container{--tw-bg-opacity: 1;background-color:rgba(255,255,255,var(--tw-bg-opacity));padding-bottom:2.5rem}\n"],encapsulation:2,changeDetection:0}),a})(),D=(()=>{class a{constructor(e){this.tradingService=e}resolve(e){return this.tradingService.fetchTradingInfo(e.queryParams.crypto?e.queryParams.crypto:"bitcoin")}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(p))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac}),a})();const W=[{path:"",component:K,resolve:{crypto:D},runGuardsAndResolvers:"paramsOrQueryParamsChange"}];let _=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[[d.Bz.forChild(W)],d.Bz]}),a})();var tt=r(8527),et=r(1641),at=r(9940),nt=r(2558),rt=r(4159),ot=r(4657);let it=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[D,y.R,v.A,C._,p],imports:[[_,l.ez,tt.N,et.F,at.h,nt.e,rt.e,ot.S]]}),a})()}}]);